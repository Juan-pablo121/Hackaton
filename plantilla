import discord
import requests
import pyttsx3
from discord.ext import commands
import random
import asyncio


def talk(text):
    engine = pyttsx3.init()
    rate = engine.getProperty("rate")
    engine.setProperty("rate", 95)
    volume = engine.getProperty("volume")
    engine.setProperty("volume", 0.9)  
    voices = engine.getProperty("voices")
    engine.setProperty("voice", voices[0].id)
    pitch = engine.getProperty("pitch")
    engine.setProperty("pitch", 60)
    engine.say(text)
    engine.runAndWait()


'#permisos'
intents = discord.Intents.default()
intents.message_content = True


aconsejar = ['Usa menos el carro: camina, usa bicicleta o transporte pÃºblico siempre que puedas.',
             'Ahorra energÃ­a en casa: apaga luces y aparatos cuando no los uses.',
             'Cambia a bombillas LED: consumen menos electricidad y duran mÃ¡s.',
             'Reduce, reutiliza y recicla: menos basura significa menos contaminaciÃ³n.',
             'Consume menos carne roja: la ganaderÃ­a produce grandes cantidades de metano.',
             'Prefiere alimentos locales y de temporada: asÃ­ se reducen emisiones del transporte.',
             'Planta Ã¡rboles: absorben diÃ³xido de carbono y dan oxÃ­geno.',
             'Cuida el agua: toma duchas cortas y evita desperdiciar.',
             'Usa energÃ­as renovables si puedes: como paneles solares o energÃ­a eÃ³lica.',
             'Evita el plÃ¡stico de un solo uso: lleva tu propia bolsa, termo o botella reutilizable.',
             'Apoya polÃ­ticas ambientales: elige lÃ­deres y proyectos que protejan el planeta',
             'Repara en lugar de desechar: alarga la vida de tus aparatos y ropa.',
             'Comparte el carro (carpooling): menos autos = menos emisiones.',
             'Cuida los ecosistemas: no tires basura en rÃ­os, playas o montaÃ±as.',
             'Informa y educa a otros: comparte lo que aprendes sobre el cambio climÃ¡tico.',
             ]
problemas = ['Aumento del nivel del mar que inundarÃ¡ ciudades costeras.',
             'Olas de calor mÃ¡s intensas y frecuentes que pondrÃ¡n en riesgo la salud.',
             'SequÃ­as prolongadas que afectarÃ¡n la producciÃ³n de alimentos.',
             'Huracanes y tormentas mÃ¡s destructivos.',
             'DesapariciÃ³n de especies animales y vegetales por pÃ©rdida de hÃ¡bitat.',
             'Derretimiento acelerado de glaciares y casquetes polares.',
             'Escasez de agua dulce para millones de personas.',
             'ExpansiÃ³n de enfermedades transmitidas por mosquitos, como dengue o malaria.',
             'AcidificaciÃ³n de los ocÃ©anos que daÃ±arÃ¡ corales y la vida marina.',
             'Migraciones masivas de personas por desastres naturales y falta de recursos.',
             ]
preguntas = preguntas = [
    {"pregunta": "Â¿CuÃ¡l es el principal gas de efecto invernadero emitido por la actividad humana?", "respuesta": "dioxido de carbono"},
    {"pregunta": "Â¿QuÃ© sector econÃ³mico es el que mÃ¡s contribuye a las emisiones globales de gases de efecto invernadero?", "respuesta": "produccion de energia"},
    {"pregunta": "Â¿QuÃ© acuerdo internacional busca limitar el aumento de la temperatura global a menos de 2 Â°C respecto a niveles preindustriales?", "respuesta": "acuerdo de Paris"},
    {"pregunta": "El deshielo de los glaciares y casquetes polares contribuye principalmente a:", "respuesta": "el aumento del nivel del mar"},
    {"pregunta": "Â¿En quÃ© capa de la atmÃ³sfera ocurre el efecto invernadero?", "respuesta": "troposfera"},
    {"pregunta": "Â¿QuÃ© ocÃ©ano es el mÃ¡s afectado por la acidificaciÃ³n debido al exceso de COâ‚‚?", "respuesta": "pacifico"},
    {"pregunta": "Â¿QuÃ© paÃ­s es actualmente el mayor emisor de diÃ³xido de carbono en el mundo?", "respuesta": "china"},
    {"pregunta": "Â¿QuÃ© fenÃ³meno climÃ¡tico extremo se vuelve mÃ¡s frecuente e intenso debido al calentamiento global?", "respuesta": "olas de calor"},
    {"pregunta": "Â¿QuÃ© capa de hielo del hemisferio norte se estÃ¡ derritiendo rÃ¡pidamente por el aumento de temperaturas?", "respuesta": "groenlandia"},
    {"pregunta": "Â¿QuÃ© actividad humana es la principal causa de la deforestaciÃ³n en la AmazonÃ­a?", "respuesta": "gaanderia"},
    {"pregunta": "Â¿QuÃ© gas de efecto invernadero es producido por el ganado durante la digestiÃ³n?", "respuesta": "metano"},
    {"pregunta": "Â¿QuÃ© continente es considerado el mÃ¡s vulnerable al cambio climÃ¡tico por su baja capacidad de adaptaciÃ³n?", "respuesta": "africa"},
    {"pregunta": "Â¿QuÃ© energÃ­a renovable utiliza el movimiento del aire para generar electricidad?", "respuesta": "energia eolica"},
    {"pregunta": "Â¿CuÃ¡l es la principal causa de la acidificaciÃ³n de los ocÃ©anos?", "respuesta": "absorcion de dioxido de carbono"},
    {"pregunta": "Â¿QuÃ© aÃ±o se firmÃ³ el Acuerdo de ParÃ­s sobre cambio climÃ¡tico?", "respuesta": "2015"},
]

'#crear bot'
bot = commands.Bot(command_prefix ="/", intents =intents)


@bot.command()
async def hola(ctx):
    await ctx.send('Hola soy tu bot de discord del clima :D')
    talk('Hola soy tu bot de discord del clima :D')


def obtener_clima(ciudad: str) -> str:
    url = f"https://wttr.in/{ciudad}?format=%C+%t&lang=es"
    respuesta = requests.get(url)
    if respuesta.status_code == 200:
        return respuesta.text.strip()
    else:
        return 'No pudimos conectarnos con la API'


@bot.command()
async def clima(ctx, *, ciudad: str):
    prediccion = obtener_clima(ciudad)
    await ctx.send(f'El clima en {ciudad} es: {prediccion}')
    talk(f'El clima en {ciudad} es: {prediccion}')


@bot.command()
async def consejos(ctx):
    consejo = random.choice(aconsejar)
    await ctx.send(f'Tu consejo sobre el medio ambiente es: {consejo}')
    talk(f'Tu consejo sobre el medio ambiente es: {consejo}')


@bot.command()
async def consecuencias(ctx):
    cons = random.choice(problemas)
    await ctx.send(f'Si no hacemos un cambio podria ocurrir: {cons}')
    talk(f'Si no hacemos un cambio podria ocurrir {cons}')


@bot.command()
async def trivia(ctx):
    # Elegir una pregunta aleatoria
    pregunta = random.choice(preguntas)

    await ctx.send(f"ğŸ² **Trivia:** {pregunta['pregunta']}\n(Â¡Tienes 30 segundos para responder!)")
    talk(f"Trivia {pregunta['pregunta']}")

    def check(m):
        return m.channel == ctx.channel and m.author == ctx.author

    try:
        # Esperar respuesta del mismo usuario (30 segundos)
        msg = await bot.wait_for("message", timeout=30.0, check=check)

        if msg.content.lower() == pregunta["respuesta"]:
            await ctx.send(f"âœ… Â¡Correcto {ctx.author.mention}! ğŸ‰")
            talk('Eres el mejor')
        else:
            await ctx.send(f"âŒ Incorrecto. La respuesta era **{pregunta['respuesta']}**.")
            talk(f"Has fallado, la respuesta era {pregunta['respuesta']}")
    except asyncio.TimeoutError:
        await ctx.send("â° Se acabÃ³ el tiempo...")
        talk('Vaya, tu tiempo se termino')


bot.run('Escribe tu token')
